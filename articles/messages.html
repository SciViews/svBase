<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Enhanced messages with 'svBase' • svBase</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="152x152" href="../apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/all.min.css" integrity="sha256-PbSmjxuVAzJ6FPvNYsrXygfGhNJYyZ2GktDbkMBqQZg=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.1/css/v4-shims.min.css" integrity="sha256-A6jcAdwFD48VMjlI3GDxUd+eCQa7/KWy6G9oe/ovaPA=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- svPkgdown --><script src="../script.js"></script><!-- themify icon --><link rel="stylesheet" href="../themify-icons.css?nocache=123">
<!--<link rel="stylesheet" href="../style.css?nocache=123">--><!-- bootstrat v4.1.1, required CSS from more recent version --><link rel="stylesheet" href="../bootstrap.more.css?nocache=123">
<link href="../style.css?nocache=123" rel="stylesheet">
<!-- end of addition for svPkgdown --><meta property="og:title" content="Enhanced messages with 'svBase'">
<!-- Mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js" async integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/config/TeX-AMS-MML_HTMLorMML.js" async integrity="sha256-4zys9A4hMQmtq2EUL+JRoXc0NZi8jVJMzb8onewOaSQ=" crossorigin="anonymous"></script><!-- Global site tag (gtag.js) - Google Analytics --><!--<script async src="https://www.googletagmanager.com/gtag/js?id=UA-462421-8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-462421-8');
</script>-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><!-- preloader start --><div class="preloader">
  <img src="../preloader.gif" alt="loading...">
</div>
<!-- preloader end -->

<div class="navbar navbar-default navbar-fixed-top bg-secondary" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <div class="navbar-brand-container">
       <div class="navbar-brand-logo">
         <a class="external-link navbar-brand" href="https://www.sciviews.org">
          <img src="../logo_full.png" alt="SciViews"></a>
       </div>
       <div class="navbar-brand-package">
      </div>
      </div>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <!-- start svPkgdown global site search with Google -->
      <form action="https://www.google.com/search" class="navbar-form navbar-right search-form-global">
        <div class="form-group has-search">
          <span class="fa fa-search form-control-feedback-global"></span>
          <input type="text" class="form-control-global search-form-input" name="q" id="q" placeholder="Search..." required><input type="hidden" name="sitesearch" value="https://www.sciviews.org">
</div>
      </form>
      <!-- end svPkgdown global site search with Google -->
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../articles/svBase.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/messages.html">Enhanced messages with 'svBase'</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/SciViews/svBase/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
<div class="navbar-title">
        <a class="navbar-brand" href="../index.html"><p class="h2">svBase <small>v1.7.3</small></p></a>
      </div>
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
  <div class="navbar-spacer bg-light">
  </div>
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Enhanced messages with ‘svBase’</h1>
                        <h4 data-toc-skip class="author">Philippe
Grosjean</h4>
            
            <h4 data-toc-skip class="date">2025-12-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/SciViews/svBase/blob/main/vignettes/messages.Rmd" class="external-link"><code>vignettes/messages.Rmd</code></a></small>
      <div class="hidden name"><code>messages.Rmd</code></div>

    </div>

    
    
<p>The {svBase} package builds on {rlang} and {cli} fantastic ways of
dealing with messages for errors or warnings. It provides a few
enhancements, like easy translation of these messages with the base R
translation mechanism. It also offers enhanced translation functions
that allow to choose the language independently from the one used in the
R session. This is useful to produce tables, figures, or other outputs
in a specific language, or in a multilingual context.</p>
<div class="section level2">
<h2 id="messages-translation">Messages translation<a class="anchor" aria-label="anchor" href="#messages-translation"></a>
</h2>
<p>Base R provides <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">gettext()</a></code>, <code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">gettextf()</a></code>, and
<code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">ngettext()</a></code> to translate messages. Moreover,
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>, <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> and <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>
are also automatically translated. However, you cannot indicate a
different language to the one used for the R session (for instance, if
you want to create a figure in French, while still getting error
messages in English). The {svBase}’s versions <code><a href="../reference/gettext_.html">gettext_()</a></code>,
<code><a href="../reference/gettext_.html">gettextf_()</a></code> and <code><a href="../reference/gettext_.html">ngettext_()</a></code> allow for
specifying <code>lang=</code> independently.</p>
<p>This works only if natural language translation is active in your R
(decision made at the compile time). Check it with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/capabilities.html" class="external-link">capabilities</a></span><span class="op">(</span><span class="st">"NLS"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  NLS </span></span>
<span><span class="co">#&gt; TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">no_nls</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/capabilities.html" class="external-link">capabilities</a></span><span class="op">(</span><span class="st">"NLS"</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.popath</span><span class="op">)</span> <span class="op">||</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/locales.html" class="external-link">Sys.getlocale</a></span><span class="op">(</span><span class="st">"LC_CTYPE"</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C"</span>, <span class="st">"POSIX"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">no_nls</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"locale -a | grep fr"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fr_FR"          "fr_FR.iso88591" "fr_FR.utf8"     "french"</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="st">"locale -a | grep de"</span>, intern <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "de_DE"          "de_DE.iso88591" "de_DE.utf8"     "deutsch"</span></span></code></pre></div>
<div class="section level3">
<h3 id="setting-first-and-secondary-languages">Setting first and secondary languages<a class="anchor" aria-label="anchor" href="#setting-first-and-secondary-languages"></a>
</h3>
<p>A “secondary” language can be set globally with
<code><a href="../reference/gettext_.html">set_sciviews_lang()</a></code>, and it is used automatically by these
versions. Here is how you can use them. First, set or get R language,
and alternate SciViews language:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gettext_.html">get_language</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Current R session language</span></span>
<span><span class="co">#&gt; [1] "en-US"</span></span>
<span><span class="fu"><a href="../reference/gettext_.html">get_sciviews_lang</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Current alternate language for gettext_()...</span></span>
<span><span class="co">#&gt; [1] "en"</span></span></code></pre></div>
<p>You change those languages like this:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">olang</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gettext_.html">set_language</a></span><span class="op">(</span><span class="st">"de"</span><span class="op">)</span></span>
<span><span class="va">olang2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gettext_.html">set_sciviews_lang</a></span><span class="op">(</span><span class="st">"fr"</span><span class="op">)</span></span>
<span><span class="co"># Check</span></span>
<span><span class="fu"><a href="../reference/gettext_.html">get_language</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "de"</span></span>
<span><span class="fu"><a href="../reference/gettext_.html">get_sciviews_lang</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fr"</span></span></code></pre></div>
<p>Now, error messages and warnings are in German, while other material
for table or plots is in French. We assigned results to
<code>olang</code> and <code>olang2</code> in order to easily comme back
later to the original languages.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span> <span class="op">+</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span></span>
<span><span class="co">#&gt; Warning in 1:2 + 1:3: longer object length is not a multiple of shorter object</span></span>
<span><span class="co">#&gt; length</span></span>
<span><span class="co">#&gt; [1] 2 4 4</span></span>
<span><span class="va">nonexisting</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> object 'nonexisting' not found</span></span></code></pre></div>
<p>But, using <code><a href="../reference/gettext_.html">gettext_()</a></code>, we got French translation:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gettext_.html">gettext_</a></span><span class="op">(</span><span class="st">"Test of svBase's `gettext()` and `gettextf()`:"</span>, domain <span class="op">=</span> <span class="st">"R-svBase"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Test of svBase's `gettext()` and `gettextf()`:"</span></span></code></pre></div>
<p>Of course, one could force a different language in
<code><a href="../reference/gettext_.html">gettext_()</a></code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gettext_.html">gettext_</a></span><span class="op">(</span><span class="st">"Test of svBase's `gettext()` and `gettextf()`:"</span>, domain <span class="op">=</span> <span class="st">"R-svBase"</span>,</span>
<span>  lang <span class="op">=</span> <span class="st">"en_US"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Test of svBase's `gettext()` and `gettextf()`:"</span></span></code></pre></div>
<p>You could use these to translate, for instance, axis labels of your
plots, or columns titles of your tables. In order to use the extraction
mechanism of <code><a href="https://rdrr.io/r/tools/update_pkg_po.html" class="external-link">tools::update_pkg_po()</a></code>, you should rename the
{svBase} function with the original base R names in your package. So,
place this somewhere in your package:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gettext</span> <span class="op">&lt;-</span> <span class="va">gettext_</span></span>
<span><span class="va">gettextf</span> <span class="op">&lt;-</span> <span class="va">gettextf_</span></span>
<span><span class="va">ngettext</span> <span class="op">&lt;-</span> <span class="va">ngettext_</span></span></code></pre></div>
<p>And use the renamed versions, otherwise, messages will not be added
automatically. You can use sometnig like <a href="https://poedit.net" class="external-link">poEdit</a> to write your translations easily.
You could also add this in a
<code>tests/testthat/test-translations.R</code> file in your {testthat}
tests to update the files automatically each time tests are run:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"The .po translation files are up to date"</span>, <span class="op">{</span></span>
<span>  <span class="fu">skip_on_cran</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu">skip_on_ci</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="co"># Update .po and .mo files (only test in the source package, not R CMD check)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="st">"../../DESCRIPTION"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span><span class="co"># This is the source of the package</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nCompiling .po files...\n"</span><span class="op">)</span></span>
<span>    <span class="va">res</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">tools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/tools/update_pkg_po.html" class="external-link">update_pkg_po</a></span><span class="op">(</span><span class="st">"../.."</span><span class="op">)</span>, silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="fu">expect_false</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">inherits</a></span><span class="op">(</span><span class="va">res</span>, <span class="st">"try-error"</span><span class="op">)</span>,</span>
<span>      <span class="st">"Updating .po files failed. Run tools::update_pkg_po() manually to debug."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specifying-language-with-ngettext_">Specifying language with <code>ngettext_()</code><a class="anchor" aria-label="anchor" href="#specifying-language-with-ngettext_"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">ngettext()</a></code> function accepts only a fixed number of
arguments, on the contrary to <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">gettext()</a></code> or
<code><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">gettextf()</a></code>. We had to remain consistent with this. So,
<code><a href="../reference/gettext_.html">ngettext_()</a></code> uses the <code>domain =</code> argument to
provide both the domain <em>and</em> the language. You must combine both
like <code>domain/lang</code>. So, <code>NULL/fr</code> will use the
default domain and French language, or <code>R-stats/de</code> uses a
specified domain and German language.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/gettext.html" class="external-link">ngettext</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"You asked for only one item"</span>, <span class="st">"You asked for several items"</span>,</span>
<span>  domain <span class="op">=</span> <span class="st">"R-svBase/fr"</span><span class="op">)</span> <span class="co"># Using svBase::ngettext_(), renamed ngettext() above</span></span>
<span><span class="co">#&gt; [1] "You asked for only one item"</span></span></code></pre></div>
<p>To reset previous languages:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/gettext_.html">set_language</a></span><span class="op">(</span><span class="va">olang</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/gettext_.html">set_sciviews_lang</a></span><span class="op">(</span><span class="va">olang2</span><span class="op">)</span></span></code></pre></div>
<p>Of course, you probably rarely change R session language, but may set
a different alternate SciViews language in an international, or polyglot
environment.</p>
</div>
</div>
<div class="section level2">
<h2 id="meaningful-error-messages">Meaningful error messages<a class="anchor" aria-label="anchor" href="#meaningful-error-messages"></a>
</h2>
<p>The {rlang} package introduced <code>abort()</code>,
<code>warn()</code> and <code>inform()</code> as alternatives to base R
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>, <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> and <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code>,
respectively. These functions provide a more structured way to create
messages, allowing for better context (see <a href="https://rlang.r-lib.org/reference/topic-error-call.html" class="external-link uri">https://rlang.r-lib.org/reference/topic-error-call.html</a>).
However, on the contrary to base <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> or
<code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>, rlang <code>abort()</code> and
<code>warn()</code> do not use the base R translation mechanism with
<code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">gettext()</a></code>, which is a drawback for package developers who
want to provide translated messages. Here, we provide
<code><a href="../reference/stop_.html">stop_()</a></code> function that combine the best of both worlds: it
uses <code><a href="https://rdrr.io/r/base/gettext.html" class="external-link">gettext()</a></code> for translation and provide the structured
messaging of {rlang}. In a package, you should rename it into
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> to have all messages translated automatically by
tools like <code>xgettext</code>. There is also <code><a href="../reference/stop_.html">warning_()</a></code>
that you may want to convert into <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use svBase stop_() and warning_(), but renamed</span></span>
<span><span class="co"># in your package (don't export stop and warning)</span></span>
<span><span class="va">stop</span> <span class="op">&lt;-</span> <span class="va">stop_</span></span>
<span><span class="va">warning</span> <span class="op">&lt;-</span> <span class="va">warning_</span></span></code></pre></div>
<p>The {rlang} presentation of the error message is now adopted in your
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> call.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"You shouldn't end up here."</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> You shouldn't end up here.</span></span></code></pre></div>
<p>If you run this in RStudio or Positron, you see an additional line
“Run <code><a href="https://rlang.r-lib.org/reference/last_error.html" class="external-link">rlang::last_trace()</a></code> to see where the error occurred.”
that helps debugging. In An R Markdown or Quarto document, like this
vignette, it does not appear. Compare this with base
<code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code>:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">base</span><span class="fu">::</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"You shouldn't end up here."</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;">:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> You shouldn't end up here.</span></span></code></pre></div>
<p>The “new” <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> works similarly to base
<code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>, except that the default value for
<code>call. =</code> is <code>FALSE</code>.</p>
<p>The “new” <code><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop()</a></code> exposes more arguments than its base R
equivalents. It first changes the default for <code>call. =</code> to
<code>FALSE</code>, and even ignores it. It is superseded by the more
informative presentation of the function call, implemented in
{rlang}:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A simple function that raises an error</span></span>
<span><span class="va">err_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"You shouldn't end up here."</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">err_fun</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `err_fun()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> You shouldn't end up here.</span></span></code></pre></div>
<p>Additional arguments, inherited from rlang <code>abort()</code> are
(see following sections for more explanations):</p>
<ul>
<li>
<code>class</code>: the class of the error message,
<code>NULL</code> by default.</li>
<li>
<code>call</code>: the call to be displayed in the error message. By
default, it is the call of the function that raised the error. You can
change it to another call, or set it to <code>NULL</code> to avoid
displaying any call.</li>
<li>
<code>envir</code>: the environment where to evaluate the message
expressions.</li>
<li>
<code>last_call</code>: the last call issued by the user, used to
check if a dot (<code>.</code>) object was invoked. In this case,
additional information about the data-dot mechanism is added to the
error message, see <code><a href="../reference/data_dot_mechanism.html">?data_dot_mechanism</a></code>.</li>
</ul>
<div class="section level3">
<h3 id="classed-error-messages">Classed error messages<a class="anchor" aria-label="anchor" href="#classed-error-messages"></a>
</h3>
<p>The <code>class=</code> argument allows to define a different class
for each error message. This class is <em>not</em> visible to the
end-user, but it can be used to more surely identify the error message
that was triggered in tests. The {testthat} function
<code>expect_error()</code> uses regular expressions to track messages.
This mechanisms is not always reliable, especially when messages are
translated, or when messages are rewritten. <code>expect_error()</code>
can also indicate the <code>class</code>of the error message to
track:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Classed error message</span></span>
<span><span class="va">err_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"You shouldn't end up here."</span>, class <span class="op">=</span> <span class="st">"my_error_class"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>In {testthat} tests, you could then write something like this:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">expect_error</span><span class="op">(</span><span class="fu">err_fun</span><span class="op">(</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"my_error_class"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="message-formatting">Message formatting<a class="anchor" aria-label="anchor" href="#message-formatting"></a>
</h3>
<p>svBase’s <code><a href="../reference/stop_.html">stop_()</a></code> uses {cli} message formatting as in
<code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code>, which allows to easily format messages
with special tags. See <a href="https://rlang.r-lib.org/reference/topic-condition-formatting.html" class="external-link uri">https://rlang.r-lib.org/reference/topic-condition-formatting.html</a>
and <code>?help('inline-markup', package = 'cli')</code> for more
information about message formatting with {cli}.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># An enhanced error message with formatting</span></span>
<span><span class="va">decrement</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"{.var x} must be a numeric vector."</span>,</span>
<span>      i <span class="op">=</span> <span class="st">"You've supplied a {.cls {class(x)}}."</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"x_not_numeric"</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">decrement</span><span class="op">(</span><span class="st">"a string"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `decrement()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `x` must be a numeric vector.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You've supplied a <span style="color: #0000BB;">&lt;character&gt;</span>.</span></span></code></pre></div>
<p>The <code>envir=</code> argument indicates in which environment {cli}
should interpolate its formatting fields (the default value is OK most
of the time).</p>
</div>
<div class="section level3">
<h3 id="additional-information-with---or-data-dot">Additional information with . or data-dot<a class="anchor" aria-label="anchor" href="#additional-information-with---or-data-dot"></a>
</h3>
<p>In the special case where the data-dot mechanism was triggered, or
when <code>.</code> is passed as first argument, extra information that
may be useful in this context is automatically appended to the
<code><a href="../reference/stop_.html">stop_()</a></code> message. The context where to look for it is
provided in the <code>last_call=</code> argument (you rarely have to
change its default value, so, you could forgot its existence).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Trying to use our decrement() function on a data frame</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/dtx.html">dtx</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">decrement</span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `decrement()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `x` must be a numeric vector.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You've supplied a <span style="color: #0000BB;">&lt;data.trame/data.frame&gt;</span>.</span></span>
<span></span>
<span><span class="co"># Idem, but when providing the argument as `.`</span></span>
<span><span class="va">.</span><span class="op">=</span> <span class="va">df</span></span>
<span><span class="fu">decrement</span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `decrement()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> `x` must be a numeric vector.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You've supplied a <span style="color: #0000BB;">&lt;data.trame/data.frame&gt;</span>.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="font-style: italic;">`.` is a data frame with 5 rows and 2 columns: 'x', 'y'</span></span></span></code></pre></div>
<p>An additional line with more info about the content of <code>.</code>
is automatically appended to the error message. This eases debugging
when passing, for instance, <code>.</code> in a pipeline.</p>
<p>Also, when the data_dot mechanism was triggered, additional lines of
information are automatically appended to the error message emphasizing
it.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># A data-dot function</span></span>
<span><span class="va">my_head</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span> <span class="op">=</span> <span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">rows</span> <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This makes it a data-dot function</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="../reference/prepare_data_dot.html">prepare_data_dot</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/prepare_data_dot.html">recall_with_data_dot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># Checking rows (note, for simplicity, we consider data has several rows)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">rows</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1L</span> <span class="op">||</span></span>
<span>      <span class="va">rows</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">||</span> <span class="va">rows</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Incorrect {.arg rows} argument."</span>,</span>
<span>      i <span class="op">=</span> <span class="st">"You must provide a single integer between 1 and {nrow(.data)}."</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"rows_wrong_value"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">.data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">rows</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_head</span><span class="op">(</span><span class="va">df</span>, <span class="fl">2L</span><span class="op">)</span> <span class="co"># OK</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A data.trame: [2 × 2]</span></span></span>
<span><span class="co">#&gt;       x      y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 -<span style="color: #BB0000;">1.40</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2  0.255</span></span>
<span><span class="fu">my_head</span><span class="op">(</span><span class="va">df</span>, <span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="co"># Error</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `my_head()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span></code></pre></div>
<p>Now, using the data-dot mechanism to insert <code>.</code> as first
arg.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">.</span><span class="op">=</span> <span class="va">df</span></span>
<span><span class="fu">my_head</span><span class="op">(</span><span class="fl">2L</span><span class="op">)</span> <span class="co"># OK</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A data.trame: [2 × 2]</span></span></span>
<span><span class="co">#&gt;       x      y</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 -<span style="color: #BB0000;">1.40</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2  0.255</span></span>
<span><span class="fu">my_head</span><span class="op">(</span><span class="op">-</span><span class="fl">1L</span><span class="op">)</span> <span class="co"># Error message with additional info for data-dot</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `my_head()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> <span style="font-style: italic;">The data-dot mechanism was likely activated</span> (see</span></span>
<span><span class="co">#&gt;   `?svBase::data_dot_mechanism()`).</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">•</span> <span style="font-style: italic;">`.` is a data frame with 5 rows and 2 columns: 'x', 'y'</span></span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="easily-changing-the-context-of-an-error-message">Easily changing the context of an error message<a class="anchor" aria-label="anchor" href="#easily-changing-the-context-of-an-error-message"></a>
</h3>
<p>It is quite common to use “input checker” functions to validate
arguments of a function. One could rewrite <code>my_head()</code> like
this:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_rows</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">arg</span> <span class="op">=</span> <span class="st">"x"</span>, <span class="va">max_value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1L</span> <span class="op">||</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">||</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">max_value</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Incorrect {.arg {arg}} argument."</span>,</span>
<span>      i <span class="op">=</span> <span class="st">"You must provide a single integer between 1 and {max_value}."</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"rows_wrong_value"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_head</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span> <span class="op">=</span> <span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">rows</span> <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This makes it a data-dot function</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="../reference/prepare_data_dot.html">prepare_data_dot</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/prepare_data_dot.html">recall_with_data_dot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">check_rows</span><span class="op">(</span><span class="va">rows</span>, <span class="st">"rows"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">.data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">rows</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_head</span><span class="op">(</span><span class="va">df</span>, <span class="fl">10L</span><span class="op">)</span> <span class="co"># Error</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `my_head()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span></code></pre></div>
<p>On the contrary to <code>abort()</code> (see <a href="https://rlang.r-lib.org/reference/topic-error-call.html#passing-the-user-context" class="external-link uri">https://rlang.r-lib.org/reference/topic-error-call.html#passing-the-user-context</a>),
the context is automatically set to <code>my_head()</code>, but it is
<code><a href="../reference/prepare_data_dot.html">prepare_data_dot()</a></code> that manages to do that. Actually,
<code><a href="../reference/stop_.html">stop_()</a></code> is designed to be used inside input checkers. If
you want to avoid this mechanism, you <em>must</em> provide a different
value for <code>call=</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check_rows2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">arg</span> <span class="op">=</span> <span class="st">"x"</span>, <span class="va">max_value</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">is.numeric</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">||</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">!=</span> <span class="fl">1L</span> <span class="op">||</span></span>
<span>      <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">1</span> <span class="op">||</span> <span class="va">x</span> <span class="op">&gt;</span> <span class="va">max_value</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span>call <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">environment</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="st">"Incorrect {.arg {arg}} argument."</span>,</span>
<span>      i <span class="op">=</span> <span class="st">"You must provide a single integer between 1 and {max_value}."</span>,</span>
<span>      class <span class="op">=</span> <span class="st">"rows_wrong_value"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_head2</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.data</span> <span class="op">=</span> <span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="va">rows</span> <span class="op">=</span> <span class="fl">6L</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># This makes it a data-dot function</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="../reference/prepare_data_dot.html">prepare_data_dot</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="../reference/prepare_data_dot.html">recall_with_data_dot</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">check_rows2</span><span class="op">(</span><span class="va">rows</span>, <span class="st">"rows"</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">.data</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">.data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">rows</span>, <span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_head2</span><span class="op">(</span><span class="va">df</span>, <span class="fl">10L</span><span class="op">)</span> <span class="co"># Error</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `check_rows2()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span></code></pre></div>
<p>But you easily realize that it is much better to point to the
function that the end-user called (<code>my_head()</code> above),
instead of a function called inside it (<code>check_rows2()</code>).</p>
<p>Now, if <code>my_head()</code> is called from another function, say
<code>my_fun()</code>, the focus is still on <code>my_head()</code> by
default:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">rows</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">my_head</span><span class="op">(</span><span class="va">x</span>, rows <span class="op">=</span> <span class="va">rows</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_fun</span><span class="op">(</span><span class="va">df</span>, <span class="fl">10L</span><span class="op">)</span> <span class="co"># Error</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `my_head()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span></code></pre></div>
<p>You can easily change this behavior globally for all your
<code><a href="../reference/stop_.html">stop_()</a></code> calls by defining
<code>.__top_call__. &lt;- TRUE</code> in the body of the function that
should receive the focus of the error message. So, this does the
work:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_fun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">rows</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">.__top_call__.</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span>  </span>
<span>  <span class="fu">my_head</span><span class="op">(</span><span class="va">x</span>, rows <span class="op">=</span> <span class="va">rows</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">my_fun</span><span class="op">(</span><span class="va">df</span>, <span class="fl">10L</span><span class="op">)</span> <span class="co"># Error</span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `my_fun()`:</span></span></span>
<span><span class="co">#&gt; <span style="color: #BBBB00;">!</span> Incorrect `rows` argument.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> You must provide a single integer between 1 and 5.</span></span></code></pre></div>
<p>On the contrary to rlang’s <code>abort()</code>, you do not need to
redefine <code>call=</code> in the input checker function, or any
intermediate function(s). Now, this work well when the top function has
the same argument (name). If this is not the case, the error message
will refer to something that does not exist in the focused function. In
this case, you should use rlang’s <a href="https://rlang.r-lib.org/reference/topic-error-chaining.html" class="external-link">error
chains</a>.</p>
</div>
<div class="section level3">
<h3 id="note-about-warning_">Note about <code>warning_()</code><a class="anchor" aria-label="anchor" href="#note-about-warning_"></a>
</h3>
<p><code><a href="../reference/stop_.html">warning_()</a></code> is much like base’s <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code>,
except for its <code>call. = FALSE</code> default argument. <strong>It
does not uses the formatting advantages of
<code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_warn()</a></code>.</strong> This is because the formatting
slows down significantly your code. So, in case you generate a lot of
warnings, the impact could become measurable. For <code><a href="../reference/stop_.html">stop_()</a></code>,
it is less of a problem, since your code already failed anyway.
Situations where it fails a lot of times, but still continues to run
(e.g., in a <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code>) are much less frequent.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><!-- footer --><!--<footer class="bg-secondary">--><div class="bg-secondary full-width">
    <div class="py-100 border-bottom" style="border-color: #454547 !important">
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-md-4">
                    <div class="mb-5 mb-md-0 text-center text-md-left">
                        <!-- logo -->
                        <img class="mb-30" src="https://www.sciviews.org/images/logo-footer.png" alt="logo"><p class="text-white mb-30"> We build software for reproducible research with R</p>
                        <!-- social icon -->
                        <ul class="list-inline">
<li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://github.com/SciViews">
                                    <i class="ti-github"></i>
                                </a>
                            </li>

                            <li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://twitter.com/PhilGrosjean">
                                    <i class="ti-twitter-alt"></i>
                                </a>
                            </li>

                            <li class="list-inline-item">
                                <a class="external-link social-icon-outline" href="https://www.linkedin.com/in/philippe-grosjean-5b6b29a2/">
                                    <i class="ti-linkedin"></i>
                                </a>
                            </li>

                        </ul>
</div>
                </div>
                <!-- footer links -->
                <div class="col-lg-2 col-md-4 col-6">
                    <p class="h4 text-white mb-4">Related</p>
                    <ul class="footer-links">
<li>
                            <a href="http://econum.umons.ac.be" class="external-link">Our Lab</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/fs/en/" class="external-link">Our Faculty</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/complexys/en/" class="external-link">Complexys</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/infortech/en/" class="external-link">InforTech</a>
                        </li>

                        <li>
                            <a href="https://web.umons.ac.be/en/" class="external-link">UMONS</a>
                        </li>

                    </ul>
</div>
                <!-- footer links -->
                <div class="col-lg-2 col-md-4 col-6">
                    <p class="h4 text-white mb-4">Quick Link</p>
                    <ul class="footer-links">
<li>
                            <a href="https://www.sciviews.org/software/svbox" class="external-link">SciViews Box</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/software/sciviews-r" class="external-link">SciViews::R</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/software/zooimage" class="external-link">Zoo/PhytoImage</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/blog" class="external-link">Blog</a>
                        </li>

                        <li>
                            <a href="https://www.sciviews.org/about" class="external-link">About</a>
                        </li>

                    </ul>
</div>
                <!-- subscribe form -->
                <div class="col-lg-3 col-md-12 offset-lg-1">
                    <div class="mt-5 mt-lg-0 text-center text-md-left">
                             <p class="h4 mb-4 text-white">Contact Us</p>
                             <p class="text-white mb-4">Need more info?<br><a href="mailto:info@sciviews.org"><span class="text-primary">Leave us a mail...</span></a></p>

                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- copyright -->
    <div class="pt-4 pb-3 position-relative">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-5">
                    <p class="text-white text-center text-md-left">
                        <span class="text-primary">SciViews</span> © All Right Reserved</p>
                </div>
                <div class="col-lg-6 col-md-7">
                    <ul class="list-inline text-center text-md-right">
<li class="list-inline-item mx-lg-3 my-lg-0 mx-2 my-2">
                            <a class="external-link font-secondary text-white" href="https://creativecommons.org/licenses/by/4.0/">Site content under CC-BY 4.0 license</a>
                        </li>

                    </ul>
</div>
            </div>
        </div>
        <!-- back to top -->
        <!--<button class="back-to-top">
            <i class="ti-angle-up"></i>
        </button>-->
    </div>
</div>
<!--</footer>-->
<!-- /footer -->

      </footer>
</div>






  </body>
</html>
